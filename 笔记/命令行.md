# å¸¸è§å‘½ä»¤

## Macos

### æŸ¥çœ‹ç«¯å£å¯¹åº”çš„è¿›ç¨‹

lsof -i :3000

### æŸ¥çœ‹è¿›ç¨‹å®Œæ•´æ‰§è¡Œå‘½ä»¤å’Œè·¯å¾„

ps -p `<PID>` -o pid,comm,command

## pm2

ä»¥ä¸‹æ˜¯ `PM2`ï¼ˆNode.js çš„è¿›ç¨‹ç®¡ç†å™¨ï¼‰ **å¸¸ç”¨å‘½ä»¤æ±‡æ€»æ¸…å•** ï¼Œé€‚åˆå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼š

---

## ğŸš€ å¯åŠ¨å’Œç®¡ç†åº”ç”¨

| å‘½ä»¤                             | è¯´æ˜                            |
| -------------------------------- | ------------------------------- |
| `pm2 start app.js`               | å¯åŠ¨ `app.js`                   |
| `pm2 start app.js --name my-app` | å¯åŠ¨å¹¶æŒ‡å®šè¿›ç¨‹å                |
| `pm2 start ecosystem.config.js`  | é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨å¤šä¸ªåº”ç”¨        |
| `pm2 restart app`                | é‡å¯æŸä¸ªåº”ç”¨ï¼ˆå¯ä»¥ç”¨åç§°æˆ– IDï¼‰ |
| `pm2 reload app`                 | æ— ç¼é‡å¯åº”ç”¨ï¼ˆé€‚åˆç”Ÿäº§ï¼‰        |
| `pm2 stop app`                   | åœæ­¢åº”ç”¨                        |
| `pm2 delete app`                 | åˆ é™¤åº”ç”¨ï¼ˆä»è¿›ç¨‹åˆ—è¡¨ç§»é™¤ï¼‰      |

---

## ğŸ“‹ æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—

| å‘½ä»¤           | è¯´æ˜                       |
| -------------- | -------------------------- |
| `pm2 list`     | æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€         |
| `pm2 status`   | åŒ `pm2 list`              |
| `pm2 show app` | æŸ¥çœ‹æŸä¸ªåº”ç”¨çš„è¯¦ç»†ä¿¡æ¯     |
| `pm2 logs`     | æŸ¥çœ‹æ‰€æœ‰åº”ç”¨çš„æ—¥å¿—         |
| `pm2 logs app` | æŸ¥çœ‹æŒ‡å®šåº”ç”¨çš„æ—¥å¿—         |
| `pm2 monit`    | è¿›ç¨‹èµ„æºç›‘æ§ç•Œé¢ï¼ˆäº¤äº’å¼ï¼‰ |

---

## ğŸ”§ é…ç½®ä¸ç®¡ç†

| å‘½ä»¤              | è¯´æ˜                                                           |
| ----------------- | -------------------------------------------------------------- |
| `pm2 startup`     | è®¾ç½® PM2 åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼ˆè¿”å›ä¸€æ¡ä½ è¦æ‰§è¡Œçš„ `sudo`å‘½ä»¤ï¼‰ |
| `pm2 save`        | ä¿å­˜å½“å‰çš„è¿›ç¨‹åˆ—è¡¨ï¼Œç”¨äºå¼€æœºè‡ªåŠ¨å¯åŠ¨                           |
| `pm2 delete all`  | åˆ é™¤æ‰€æœ‰ PM2 ç®¡ç†çš„è¿›ç¨‹                                        |
| `pm2 stop all`    | åœæ­¢æ‰€æœ‰è¿›ç¨‹                                                   |
| `pm2 restart all` | é‡å¯æ‰€æœ‰è¿›ç¨‹                                                   |

---

## ğŸ“¦ éƒ¨ç½²æµç¨‹ï¼ˆå¯é€‰ï¼‰

| å‘½ä»¤                                               | è¯´æ˜           |
| -------------------------------------------------- | -------------- |
| `pm2 deploy ecosystem.config.js production setup`  | åˆå§‹åŒ–éƒ¨ç½²ç›®å½• |
| `pm2 deploy ecosystem.config.js production`        | éƒ¨ç½²ä»£ç å¹¶é‡å¯ |
| `pm2 deploy ecosystem.config.js production revert` | å›æ»šä¸Šä¸€æ¬¡éƒ¨ç½² |

> éœ€è¦ `ecosystem.config.js` é…ç½®æ–‡ä»¶ï¼Œé€‚åˆå¤šæœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆã€‚

---

## ğŸ§¾ ç¤ºä¾‹ï¼šecosystem.config.js

```js
module.exports = {
  apps: [
    {
      name: 'my-app',
      script: './app.js',
      instances: 2,
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'development',
      },
      env_production: {
        NODE_ENV: 'production',
      },
    },
  ],
};
```

---

## ğŸ§  å…¶ä»–å®ç”¨å‘½ä»¤

| å‘½ä»¤             | è¯´æ˜                  |
| ---------------- | --------------------- |
| `pm2 reload all` | æ— ç¼é‡è½½æ‰€æœ‰è¿›ç¨‹      |
| `pm2 flush`      | æ¸…ç©ºæ‰€æœ‰æ—¥å¿—          |
| `pm2 env 0`      | æŸ¥çœ‹è¿›ç¨‹ 0 çš„ç¯å¢ƒå˜é‡ |

---

å¦‚æœä½ æƒ³å¯¼å‡º/å¤‡ä»½ PM2 çŠ¶æ€ï¼Œæˆ–åšæœåŠ¡è¿ç§»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š

```bash
pm2 save               # ä¿å­˜å½“å‰çŠ¶æ€
pm2 dump               # ç”Ÿæˆ dump æ–‡ä»¶
pm2 resurrect          # æ ¹æ® dump æ–‡ä»¶æ¢å¤
```

## docker

### æ‹‰å–é•œåƒ

```bash
docker pull <image>
```

### æŸ¥çœ‹é•œåƒ

```bash
docker images
docker images -a
```

### è¿è¡Œ

```bash
docker run --name <name> -p <hostPort>:<containerPort> -v <hostPath>:<containerPath> -e <env> -d <image>

```

```
docker run --name nginx-test2 -p 80:80 -v /tmp/aaa:/usr/share/nginx/html -e KEY1=VALUE1 -d nginx:latest
-p æ˜¯ç«¯å£æ˜ å°„

-v æ˜¯æŒ‡å®šæ•°æ®å·æŒ‚è½½ç›®å½•

-e æ˜¯æŒ‡å®šç¯å¢ƒå˜é‡

-d æ˜¯åå°è¿è¡Œ
![alt text](image.png)
```

### æŸ¥çœ‹å®¹å™¨

```bash
docker ps
docker ps -a
```
